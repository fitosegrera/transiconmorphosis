<!DOCTYPE html>
<html>
<head>
	<script src="http://localhost:2013/socket.io/socket.io.js"></script>
	<script src="http://simplewebrtc.com/latest.js"></script>
	<script src="/lib/jquery-1.7.2.min.js"></script>

	<style type="text/css">
		body{
			background-color: black;
		}
		#wrapper{
			width: 100%;
			height: 100%;
			position: absolute;
		}
		#localVideo{
			position: relative;
			margin-left: 25%;
		}
		#remoteVideo{
			position: relative;
			margin-left: 25%;
		}
		#title{
			background-color: white;
			position:relative;
			margin-left: 25%;
			width:50%;
			font-family: "Courier New";
			font-size: 14px;
		}
		#chatroom{
			border:1px solid;
			border-color: #A1A1A1;
			overflow:auto;
			background-color: #030303;
			color:#C8C8C8;
			position:relative;
			width:50%;
			height:25%;
			margin-left:25%;
			font-family: "Courier New";
			font-size: 12px;

		}
		#chat_box{
			background-color: #030303;
			color:#C8C8C8;
			font-family: "Courier New";
			width:90%;
		}
		ul{
    		list-style-type: none;
    		padding: 3px;
		}
		button{
			background-color: #030303;
			color:#C8C8C8;
		}
		#align{
			display: inline-block;
			width:50%;
			margin-left:25%;
		}	
		#input{
			width:100%;
		}
		#imgs{
			display: inline-block;
			width:50%;
			margin-left:25%;
			position:relative;
			text-align: center;
		}
		#emo1{
			position:absolute;
			display:inline-block;
			width:24px;
			margin-left:-30px;
		}
		#emo2{
			position:absolute;
			display:inline-block;
			width:24px;
			padding-left:0px;
		}
		#emo3{
			position:absolute;
			display:inline-block;
			width:24px;
			padding-left:30px;
		}	
	</style>

</head>

<body>
	<div id="wrapper">
		<!--<div id="localVideo" mute></div>-->
		<div id="remoteVideo" muted></div>
		<div id="title">////TRANSICONMORPHOSIS chat-room/fito_segrera & Emilio Vavarella////</div>
		<div id="chatroom">
			<ul id="chat_log">
			</ul>
		</div>

		<div id = "align">
			<div id="input">
				<input type="text" name="chat_box" value="" id="chat_box" placeholder="type to chat..." />
				<button id = "send">send</button>
			</div>
		</div>
		<div id="imgs">
				<div id="emoticons1">
					<img id="emo1" src="img/smile.png"></img>
				</div>
				<div id="emoticons2">
					<img id="emo2" src="img/wink.png"></img>
				</div>
				<div id="emoticons3">
					<img id="emo3" src="img/sad.png"></img>
				</div>
		</div>
	</div>

	<script>
	var myLocalIp = '';
	$.ajax({url:"local_ip.txt",success:function(result){
      myLocalIp = result;
    }});

	var webrtc = new SimpleWebRTC({
		localVideoEl: 'localVideo',
		remoteVideosEl: 'remoteVideo',
		autoRequestMedia: true
	});

	webrtc.on('readyToCall', function () {
		webrtc.joinRoom('TRANSICONMORPHOSIS');
	});

	var sendChannel, receiveChannel;

	//////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////
	
	var userNameInput = prompt("Nickname: ");
	var userName = '['+userNameInput+']: '; 
	jQuery(document).ready(function () {
		var log_chat_message = function (message) {
			var li = jQuery('<li />').text(message);
			jQuery('#chat_log').append(li);
		};

		var log_chat_img = function (img, user) {
			var li;
			if(img == 'smile'){
				li = jQuery('<li />').append(user + "<img src='img/smile.png' />");
				$("#chatroom").scrollTop($("#chatroom")[0].scrollHeight);
			}else if(img == 'wink'){
				li = jQuery('<li />').append(user + "<img src='img/wink.png' />");
				$("#chatroom").scrollTop($("#chatroom")[0].scrollHeight);
			}else if(img == 'sad'){
				li = jQuery('<li />').append(user + "<img src='img/sad.png' />");
				$("#chatroom").scrollTop($("#chatroom")[0].scrollHeight);
			}
			jQuery('#chat_log').append(li);
		};

		var socket = io.connect('http://'+myLocalIp+':2013');

		socket.on('entrance', function  (data) {
			log_chat_message(data.message);
		});

		socket.on('exit', function  (data) {
			log_chat_message(data.message);
		});

		socket.on('chat', function  (data) {
			//console.log(data);
			if (data.message == 'smile') {
				log_chat_img('smile', data.user);
				$("#chatroom").scrollTop($("#chatroom")[0].scrollHeight);
			}else if (data.message == 'wink'){
				log_chat_img('wink', data.user);
				$("#chatroom").scrollTop($("#chatroom")[0].scrollHeight);
			}else if (data.message == 'sad'){
				log_chat_img('sad', data.user);
				$("#chatroom").scrollTop($("#chatroom")[0].scrollHeight);
			}else{
				log_chat_message(data.message);
				$("#chatroom").scrollTop($("#chatroom")[0].scrollHeight);
			}
		});

		//If the ENTER key is pressed after typing in the send box...
		jQuery('#chat_box').keypress(function (event) {
			if (event.which == 13) {
				socket.emit('chat', {message: jQuery('#chat_box').val()});
				jQuery('#chat_box').val(userName+'');
				$("#chatroom").scrollTop($("#chatroom")[0].scrollHeight);
			}
		});
		//If the send button is clicked...
		jQuery('#send').click(function (event) {
			socket.emit('chat', {message: jQuery('#chat_box').val()});
			jQuery('#chat_box').val(userName+'');
			$("#chatroom").scrollTop($("#chatroom")[0].scrollHeight);
		});

		//If SMILE emoticon is clicked...
		jQuery('#emo1').click(function (event) {
			socket.emit('chat', {message: 'smile', user: userName});
			$("#chatroom").scrollTop($("#chatroom")[0].scrollHeight);
		});
		//If WINK emoticon is clicked...
		jQuery('#emo2').click(function (event) {
			socket.emit('chat', {message: 'wink', user: userName});
			$("#chatroom").scrollTop($("#chatroom")[0].scrollHeight);
		});
		//If SAD emoticon is clicked...
		jQuery('#emo3').click(function (event) {
			socket.emit('chat', {message: 'sad', user: userName});
			$("#chatroom").scrollTop($("#chatroom")[0].scrollHeight);
		});

	});

	//////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////
	//////////////////////////////////////////////////////////

	</script>

</body>

</html>
